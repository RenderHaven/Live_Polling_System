services:
  # ============================
  # BACKEND (Node.js + Socket.io)
  # ============================
  - type: web
    name: poll-backend
    runtime: node
    rootDir: backend
    buildCommand: "npm install"
    startCommand: "node server.js"
    plan: free
    autoDeploy: true
    envVars:
      - key: PORT
        value: 4000

  # ============================
  # FRONTEND (React - static)
  # ============================
  - type: web
    name: poll-frontend
    runtime: static
    rootDir: frontend
    buildCommand: "npm install && npm run build"
    staticPublishPath: dist
    autoDeploy: true

    routes:
      # Forward API requests to backend
      - type: rewrite
        source: /api/*
        destination: https://poll-backend.onrender.com/api/*

      # Forward socket.io to backend
      - type: rewrite
        source: /socket.io/*
        destination: https://poll-backend.onrender.com/socket.io/*
