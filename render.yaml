services:
  # ============================
  # BACKEND (Node + Socket.io)
  # ============================
  - type: web
    name: poll-backend
    runtime: node
    rootDir: backend
    buildCommand: "npm install"
    startCommand: "node server.js"
    plan: free
    autoDeploy: true
    envVars:
      - key: PORT
        value: 4000

  # ============================
  # FRONTEND (Create React App)
  # ============================
  - type: web
    name: poll-frontend
    runtime: static
    rootDir: frontend
    buildCommand: "npm install && npm run build"
    staticPublishPath: build # ðŸ”¥ FIXED
    autoDeploy: true

    routes:
      - type: rewrite
        source: /api/*
        destination: https://poll-backend.onrender.com/api/*

      - type: rewrite
        source: /socket.io/*
        destination: https://poll-backend.onrender.com/socket.io/*
